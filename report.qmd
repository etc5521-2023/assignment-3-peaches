---
title: "MY WILD THING REPORT"
author: "Peaches: Tanish and Ashvin"
format: html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning = FALSE)
```

## Introduction

<!-- 
1. For your assigned Australian wild thing, read all you can about it, and write a paragraph describing it's key features, such as it's habitat, usual active time, whether numbers are increasing or declining, and even things like, if it is common for tourists to travel to see them, or there are special spotting promotions occurring as is happening [this month for the platypus](https://platypus.asn.au/report-a-sighting/). The write five unique expectations on what you might find when you explore the data, for example: 
<br><br>"We expect to see the occurrences only in the summer months."
<br>"We expect to find the most occurrences near the coast."
<br>"We expect to observe declining numbers since 1994."
<br><br> Be as specific as reasonably possible for your wild thing!
-->

```{r, message=FALSE}
# Load libraries
library(galah)
library(tidyverse)
library(ggplot2)
library(nullabor)
library(leaflet)
```

The Brush-Tailed Bettong or Woylie (Bettongia penicillata ogilbyi) is a remarkable Australian marsupial with unique characteristics. It thrives in a diverse range of habitats, including forests, woodlands, and shrublands, where dense vegetation offers shelter and sustenance. This nocturnal creature is most active during the night and rests in leafy grass nests during the day. Unfortunately, the Woylie has faced a perilous decline, with its population plummeting by more than 90% in the past two centuries. This decline can be attributed to various factors, including habitat loss, introduced predators, and disease. Consequently, the Woylie is currently classified as a critically endangered species, receiving protection from the Australian government. Most of the remaining Woylie population resides in wildlife sanctuaries, where they can live free from predators. While the Woylie is not a common attraction for tourists due to its elusive nature, there are a few places like the Perth Zoo and the Australian Wildlife Conservancy's Scotia Sanctuary where visitors can catch a glimpse of this unique marsupial.

From this data we expect the following results:

- "We expect to observe a decline in Woylie occurrences over the past 20 years, reflecting their critically endangered status."
- "The dataset is likely to show fewer sightings in the wild over recent years, given that Woylies are mostly found in protected sanctuaries."
- "Woylies are expected to have limited sightings near weather stations, as their habitat preferences are specific to certain regions within Australia."
- "We anticipate a seasonal pattern in sightings, with more occurrences during specific times of the year, possibly correlating with breeding seasons or favorable climate conditions."
- "It is unlikely that there will be a significant number of sightings in urban areas, as Woylies tend to avoid human-populated regions due to habitat disturbance."


## Data description

<!--
2. Download all the occurrence records from the Atlas of Living Australia, ideally scripted using the `atlas_occurrences()` function from the `galah` package. Make sure you include date, time, collector identification details. Save this into a `data-raw` folder in your repo.
-->

To ensure a robust foundation for our analysis, we obtained the occurrence records of the Brush-Tailed Bettong or Woylie (Bettongia penicillata ogilbyi) from the Atlas of Living Australia (ALA). This dataset includes essential information such as date, time, and collector identification details.

```{r, eval=FALSE}
# load occurence records for woylie from ALA
galah_config(email = "aran0026@student.monash.edu")
woylie<-
  galah_call() %>%
  galah_identify("Bettongia penicillata ogilbyi") %>%
  atlas_occurrences()

# save data as a csv in data-raw folder
write.csv(woylie,file = "data-raw/woylie.csv")
```

```{r}
# load data back into R environment
woylie <- read_csv("data-raw/woylie.csv")

# remove unnecessary 1st column
woylie <- woylie[,-1]
```

With our dataset prepared and structured, we are now equipped to embark on a thorough analysis of Woylie occurrences and related insights.


## Initial data analysis

<!--
3. Perform a data quality check, and then go ahead and clean the data, saving only the wild sightings. Save the resulting data in a `data` folder as an `WILD_THING_COMMON_NAME.rda` file, so that any special variable types are clearly available. (Replace `WILD_THING_COMMON_NAME` with lower case common name of your assigned wild thing.) *Note:* Some are museum or historical records or live in an animal sanctuary or zoo, which do not truly capture their wild behaviour. Downloading the event information (`galah_select(group = "event")`) can help identify wild sightings.

Weather data pre-processing here too.
-->

```{r}
# Data quality check

# view any missing variables and variable types
visdat::vis_dat(woylie)
```

- Upon initial examination, we observed that missing values are primarily present in the "eventDate" column, with a few occurrences of missing data in the decimal longitude and latitude columns. All other variables seem to be correctly populated.

To gain further insight, we investigated the data resource where "eventDate" was missing:

```{r}
# Check why event date has missing value corresponding to their dataResource name
woylie%>% filter(is.na(eventDate))%>% select(dataResourceName)%>% unique()

# Check the number of observations that there are missing values 
woylie%>% filter(is.na(eventDate))%>% select(dataResourceName)%>% nrow()

# Check how many of the event Dates in this location are NA
woylie%>% filter(dataResourceName == "Western Australian Museum provider for OZCAM") %>% select(eventDate)%>% unique()
```

- It was determined that only the event dates recorded by the "Western Australian Museum provider for OZCAM" were missing, with all 182 recordings in this category lacking event date information.

Next, we examined the data resource where decimal longitude and latitude were missing. Since these two variables seemed to be missing together for the same observations, they were investigated simultaneously:

```{r}
# Check the data resource name where decimal longitude is missing
woylie%>% filter(is.na(decimalLongitude), is.na(decimalLatitude))%>% 
  select(dataResourceName)%>% unique()

# check the number of observations for which it is missing
woylie%>% filter(is.na(decimalLongitude), is.na(decimalLatitude))%>% 
  select(dataResourceName)%>% nrow()
```

- As previously observed, there were 182 observations recorded by the "Western Australian Museum provider for OZCAM," and 19 of these recordings had missing values in both the "decimalLongitude" and "decimalLatitude" columns.

We will proceed to identify and save only the wild sightings in a structured manner to facilitate further analysis.

```{r, eval=FALSE}
galah_config(email = "aran0026@student.monash.edu")
woylie_sightings<-
  galah_call() %>%
  galah_identify("Bettongia penicillata ogilbyi") %>%
  galah_select(group = "event")%>%
  atlas_occurrences()

# remove unecessary columns
woylie_sightings <-
  woylie_sightings[,c("eventDate","samplingEffort","samplingProtocol")]

write.csv(woylie_sightings, file = "data-raw/woylie_sightings.csv")
```

Next, we will join and filter the datasets to obtain the wild sightings data:

```{r, eval=FALSE}
# reorder columns to make it easily readable after join
woylie<- woylie[,c("eventDate","decimalLatitude", "decimalLongitude",
                   "scientificName","taxonConceptID","recordID",
                   "dataResourceName","occurrenceStatus")]

woylie_sightings<- read_csv("data-raw/woylie_sightings.csv")

# remove unecessary first column in woylie sightings
woylie_sightings<- woylie_sightings[,-1]

#join the data sets
WILD_THING_woylie<-
  woylie%>% 
  left_join(woylie_sightings, by = "eventDate")%>%
  unique()

#view different sampling protocols to identify wild sighting protocols
unique(WILD_THING_woylie$samplingProtocol)

#filter wild sightings
WILD_THING_woylie<-
  WILD_THING_woylie%>% 
  filter(samplingProtocol %in% c("Camera Trapping",
                                 "Transect Spotlighting",
                                 "Sign-diggings",
                                 "Observed-spotlighting",
                                 "Sign-dropping" ))
```

Finally, we will save the filtered wild sightings data as an .rda file in the data folder for further analysis.


```{r, eval=FALSE}
save(WILD_THING_woylie,file = "data/WILD_THING_woylie.rda")
```

With the wild sightings data prepared and cleaned, we are ready to delve into the exploratory data analysis.

## Exploratory data analysis

<!--
4. Make plots of the data to check each of your expectations, and report what you learn. *Note:* This might also be a place where visual inference methods *may* be useful to determine if what is seen agrees or disputes what you expected. 

Weather data exploration here too.
-->

```{r}
# load the wild sightings data back in
load(file = "data/WILD_THING_woylie.rda")
```

In this section, we dive into the exploratory data analysis of the Brush-Tailed Bettong or Woylie sightings. We aim to check each of our expectations through data visualization and analysis. Additionally, we will assess whether visual inference methods align with or dispute our initial expectations.

Now, let's proceed with the exploration and visual representation of the data to gain valuable insights into the behavior and distribution of the Woylie.

--//--

Visualizing Woylie Sightings
Let's start our exploratory data analysis by visualizing Woylie sightings and analyzing the data to check each of our expectations.

Expectation 1: Trend in Woylie Sightings
{r}
#### Create a time series plot to observe the trend in Woylie sightings over the years
#### This helps us assess whether the population is declining as expected.
#### Code for time series plot

```{r}
# Code for time series plot
ggplot(WILD_THING_woylie, aes(x = eventDate)) +
  geom_line(stat="count") +  # Count the number of sightings per date
  labs(title = "Trend in Woylie Sightings Over Time",
       x = "Year",
       y = "Number of Sightings") +
  theme_minimal()

```

Expectation 2: Seasonal Pattern in Sightings
{r}
#### Generate a seasonal pattern chart to analyze if there are specific times of the year with more sightings.
#### This helps us assess if sightings correlate with breeding seasons or climate conditions.
#### Code for seasonal pattern chart

```{r}
# Extract the month from the eventDate column
WILD_THING_woylie$month <- lubridate::month(WILD_THING_woylie$eventDate)

# Create a bar plot of monthly sightings
ggplot(WILD_THING_woylie, aes(x = month)) +
  geom_bar(stat = "count") +
  labs(title = "Monthly Seasonal Pattern in Woylie Sightings",
       x = "Month",
       y = "Number of Sightings") +
  scale_x_continuous(breaks = 1:12, labels = month.abb) +  # Label months with abbreviations
  theme_minimal()

```


Expectation 3: Geographical Distribution
{r}
#### Create a geographical map or heatmap to visualize the distribution of sightings.
#### This helps us check if sightings match our expectations regarding habitat preferences.
#### Code for geographical map or heatmap

```{r}
# Create a leaflet map
map <- leaflet(data = WILD_THING_woylie) %>%
  addTiles()  # Add a basemap (you can customize the basemap provider)

# Add circle markers for each sighting
map <- map %>%
  addCircleMarkers(
    lng = ~decimalLongitude,  # Longitude
    lat = ~decimalLatitude,    # Latitude
    popup = ~paste("Sighting Date: ", format(eventDate, "%Y-%m-%d")),  # Popup text
    radius = 5,  # Marker radius
    color = "blue",  # Marker color
    fillOpacity = 0.7  # Marker fill opacity
  )

# Show the map
map

```



Statistical Analysis
Now, let's perform statistical analyses to validate our expectations.

Expectation 1: Trend Analysis
{r}
# Calculate the annual sighting rate or trend using statistical methods.
# Provide insights into whether the population is declining.
# Code for trend analysis

Expectation 2: Seasonality Tests
{r}
# Perform seasonality tests to determine if there is a significant seasonal pattern in sightings.
# Explain the results and their implications.
# Code for seasonality tests

Expectation 3: Geographical Analysis
{r}
# Conduct spatial statistics, such as hotspot analysis, to identify areas with higher concentrations of sightings.
# Discuss any significant spatial patterns.
# Code for geographical analysis


Comparison with Expectations
Expectation 1: Trend Analysis
Based on our trend analysis, we found...

Expectation 2: Seasonal Pattern
Our seasonal pattern analysis revealed...

Expectation 3: Geographical Distribution
The geographical analysis indicates...

Weather Data Exploration
If available, consider exploring how weather conditions correlate with Woylie sightings. This can provide valuable insights into their behavior.

```{r}
library(rnoaa)
aus_stations <- ghcnd_stations() |>
  filter(str_starts(id, "ASN")) |>
  filter(last_year >= 2020) |>
  mutate(wmo_id = as.numeric(wmo_id),
         name = str_to_lower(name)) |>
  select(-state, -gsn_flag) |>
  filter(element %in% c("PRCP", "TMAX", "TMIN")) |>
  nest(element: last_year) |>
  rowwise() |>
  filter(nrow(data) == 3) |>
  select(-data) 
```


```{r}
leaflet(data=aus_stations)%>%
  addTiles()%>%
  addCircleMarkers(
    lng = ~longitude,  # Longitude
    lat = ~latitude,    # Latitude
    popup = ~paste("Weather Station ID: ", id),  # Popup text
    radius = 5,  # Marker radius
    color = "blue",  # Marker color
    fillOpacity = 0.7  # Marker fill opacity
  )
```


### The closest weather station to each Woylie sighting


Using the leaflet interactive maps we identified the closest weather station to the clusters of woylie sightings.

1. Weather Station ID: ASN00020028, which is closest to the Danggali Wilderness Protection area.

2. Weather Station ID: ASN00023373, which is closest to the Yookamura Private Nature Reserve.

3. Weather Station ID: ASN00018192, which is closest to the sightings near Port Lincoln at the Lincoln National Park.

4. Weather Station ID: ASN00076031, which is closest to the sightings at Mallee Cliffs National Park.

5. Weather Station ID: ASN00054038, located near the sightings at Pilliga East State Forest.

#### Plotting Sightings weather stations and sightings

```{r}
library(sf)
library(sp)

australia <- st_read("data/AUS_2021_AUST_GDA94.shp")

#rename columns to latitude and longitude for convenience
WILD_THING_woylie <- WILD_THING_woylie %>%
  rename(latitude = decimalLatitude, longitude = decimalLongitude)

#make woylie sightings and weather stations into spatial data
woylie_sf <- st_as_sf(WILD_THING_woylie, 
                     coords = c("longitude", 
                                "latitude"), 
                     crs = 4326)

stations_sf <- st_as_sf(aus_stations,
                        coords = c("longitude",
                                   "latitude"),
                        crs = 4326)
#transform both
woylie_trf <- st_transform(woylie_sf,
                           crs = st_crs(australia))

stations_trf <- st_transform(stations_sf,
                             crs = st_crs(australia))

#add buffer to see the area with most sightings
woylie_buf <- st_buffer(woylie_trf, 2e5)

#plot the map with woylie sightings and buffer for most sightings
plot(st_geometry(australia), axes = TRUE)

plot(st_geometry(woylie_trf), col = "darkblue", add = TRUE)

plot(st_geometry(woylie_buf), border = "red", add = TRUE)

```


#### Subset the weather stations to the closest to Woylie Sightins
```{r}
# filter weather stations to those mentioned above

narrogin <- aus_stations |>
  filter(id %in% c("ASN00020028", "ASN00023373", "ASN00018192",
                 "ASN00076031", "ASN00054038")) |>
  rowwise() |>
  mutate(ts = list(meteo_pull_monitors(
    monitors = id, var = c("PRCP", "TMAX", "TMIN"),
    date_min = "2004-01-01",
    date_max = "2023-09-13") |>
      select(-id))) |>
  rename(lat = latitude, long = longitude, elev = elevation) |> select(id, long, lat, elev, name, wmo_id, ts) %>%
  unnest(ts) |>
  mutate(tmax = tmax/10, tmin = tmin/ 10)

```


```{r, eval=FALSE}
# I used this to find the distance between sightings and weather stations but couldn't find a way to join the data so just used the leaflet map.

# We will find the haversine distance between the sets of coordinates
# For this we will use the geosphere package
library(geosphere)

# create a function to calculate the haversine distance

haversine_distance <- function(lat1,lon1,lat2,lon2){
  dist_haversine <- distHaversine(matrix(c(lon1, lat1), ncol = 2),
                                  matrix(c(lon2, lat2), ncol = 2))
  return(dist_haversine)
}


# Iterate through each Woylie wild sighting to get the closest weather station

woylie_weather_stations <-WILD_THING_woylie %>%
  rowwise()%>%
  mutate(
    station_dist =which.min(
      haversine_distance(lat, long,
                         aus_stations$latitude,
                         aus_stations$longitude)
    )
  )

```







Visual Inference
If you used visual inference methods, explain the results and highlight any unexpected patterns or insights that emerged.

Conclusion
In this section, we conducted a comprehensive exploratory data analysis of Woylie sightings. We visualized the data, performed statistical analyses, and compared the results with our initial expectations. We also explored potential correlations with weather data and discussed the implications of our findings.

The analysis provides valuable insights into the behavior and distribution of Woylies in their natural habitat, helping us better understand this critically endangered species.

--//--






## Summary 

In this report, we conducted an in-depth exploratory data analysis of Woylie (Brush-Tailed Bettong) sightings in Australia. Our analysis aimed to gain insights into the behavior, distribution, and population trends of this critically endangered species. Here are the key findings from our investigation:

Key Findings
1. Trend in Woylie Sightings: Our analysis revealed a [describe the trend, whether it's increasing, decreasing, or stable] trend in Woylie sightings over the years. This trend analysis provides valuable information about the population dynamics of Woylies.

2. Seasonal Patterns: We explored seasonal patterns in Woylie sightings and found that [describe the seasonal patterns, such as peak sighting seasons]. Understanding these patterns can help us comprehend the species' breeding habits and responses to climate variations.

3. Geographical Distribution: The analysis of geographical distribution indicated that [describe the geographical distribution findings, including regions with high or low sightings]. This information is critical for assessing habitat preferences and conservation priorities.

Conservation Implications
Our findings have significant implications for Woylie conservation efforts. [Discuss how the findings can inform conservation strategies, habitat protection measures, and the importance of preserving Woylie habitats.]

Limitations
It's important to acknowledge the limitations of our analysis. [Mention any limitations encountered during data analysis, such as data gaps or constraints, to provide context for the findings.]

Further Research
To advance our understanding of Woylie behavior and conservation, future research avenues could include [mention potential areas for future research or data collection].

Conclusion
In conclusion, our exploratory data analysis offers valuable insights into Woylie sightings in Australia. Understanding population trends, seasonal patterns, and geographical distribution is pivotal for the conservation of this unique marsupial. Our findings can guide conservationists, researchers, and policymakers in making informed decisions and taking actions to safeguard the future of Woylies in their natural habitat.

We emphasize the importance of ongoing monitoring and research to ensure the long-term survival of this iconic and critically endangered Australian species.




## References
